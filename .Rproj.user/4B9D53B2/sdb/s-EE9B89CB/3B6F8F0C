{
    "collab_server" : "",
    "contents" : "# server.R\nrequire(ggplot2)\nrequire(dplyr)\nrequire(shiny)\nrequire(shinydashboard)\nrequire(data.world)\nrequire(readr)\nrequire(DT)\n\nshinyServer(function(input, output) { \n  # These widgets are for the Crosstabs tab.\n  online1 = reactive({input$rb1})\n  KPI_Low = reactive({input$KPI1})     \n  KPI_Medium = reactive({input$KPI2})\n  \n  # Begin Crosstab Tab 1 ------------------------------------------------------------------\n  df1 <- eventReactive(input$click1, {\n    if(online1() == \"SQL\") {\n      print(\"Getting from data.world\")\n      query(\n        data.world(propsfile = \"www/.data.world\"),\n        dataset=\"jlee/s-17-dv-project-5\", type=\"sql\",\n        query=\"select `Sub-Category`, `Country`, \n        sum(Profit) as sum_profit, \n        sum(Sales) as sum_sales, \n        sum(Profit) / sum(Sales) as ratio,\n        \n        case\n        when sum(Profit) / sum(Sales) < ? then '03 Low'\n        when sum(Profit) / sum(Sales) < ? then '02 Medium'\n        else '01 High'\n        end AS kpi\n        \n        from `globalshipments.csv/globalshipments`\n        group by `Sub-Category`, `Country`\n        order by `Sub-Category`, `Country`\",\n        queryParameters = list(KPI_Low(), KPI_Medium())\n      ) # %>% View()\n    }\n    else {\n      print(\"Getting from csv\")\n      file_path = \"www/globalshipments.csv\"\n      df <- readr::read_csv(file_path)\n      df %>% \n        dplyr::group_by(`Sub-Category`, Country) %>% \n        dplyr::summarize(sum_profit = sum(Profit), sum_sales = sum(Sales),\n                         ratio = sum(Profit) / sum(Sales),\n                         kpi = if_else(ratio <= KPI_Low(), '03 Low',\n                                       if_else(ratio <= KPI_Medium(), '02 Medium', '01 High'))) # %>% View()\n    }\n  })\n  output$data1 <- renderDataTable({DT::datatable(df1(), rownames = FALSE,\n                                                 extensions = list(Responsive = TRUE, FixedHeader = TRUE)\n  )\n  })\n  output$plot1 <- renderPlot({ggplot(df1()) + \n      theme(axis.text.x=element_text(angle=90, size=15, vjust=0.5)) + \n      theme(axis.text.y=element_text(size=5, hjust=0.5)) +\n      geom_text(aes(x=`Sub-Category`, y=Country, label=sum_sales), size=2) +\n      geom_tile(aes(x=`Sub-Category`, y=Country, fill=kpi), alpha=0.50)\n      # coord_fixed(ratio = 1)\n      # theme(panel.background = element_rect(size = 150))\n  })\n  # End Crosstab Tab 1 ___________________________________________________________\n  \n  })\n",
    "created" : 1492463503865.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1996310206",
    "id" : "3B6F8F0C",
    "lastKnownWriteTime" : 1492461070,
    "last_content_update" : 1492461070,
    "path" : "~/Desktop/eDV Project 5/02 Shiny/Crosstab2/server.R",
    "project_path" : "02 Shiny/Crosstab2/server.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}